<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,800" rel="stylesheet">

    <!-- Required Framework -->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap/css/bootstrap.min.css">

    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">

</head>

<body class="fix-menu">

    <section class="login p-fixed d-flex text-center bg-primary common-img-bg">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <div class="login-card card-block auth-body mr-auto ml-auto">
                        <form id="prototype" class="md-float-material">
                            <div class="auth-box">
                                <div class="row m-b-20">
                                    <div class="col-md-12">
                                        <h3 class="text-left txt-primary">u4e1_prototipos.html</h3>
                                    </div>
                                </div>
                                <hr/>
                                <div class="input-group">
                                    <input type="text" id="name" class="form-control" placeholder="Nombre" required>
                                    <span class="md-line"></span>
                                </div>

                                <br>

                                <div class="row m-t-25 text-left">
                                    <div class="col-sm-6 col-xs-12">
                                        <div class="input-group">
                                            <input type="number" id="age" class="form-control" placeholder="Edad" required>
                                            <span class="md-line"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 col-xs-12">
                                        <div class="input-group">
                                            <input type="number" id="training" class="form-control" placeholder="Ciclo" required>
                                            <span class="md-line"></span>
                                        </div>
                                    </div>
                                </div>

                                <br>

                                <div class="input-group">
                                    <select id="partner" class="form-control" required>
                                        <option id="numPartner" value="">Sin registros</option>
                                    </select>
                                </div>

                                <br>

                                <div class="row m-t-30">
                                    <div class="col-md-6">
                                        <button type="button" id="save" class="btn btn-primary btn-md btn-block waves-effect text-center m-b-20">Guardar</button>
                                    </div>
                                    <div class="col-md-6">
                                        <button type="button" id="search" class="btn btn-primary btn-md btn-block waves-effect text-center m-b-20">Consultar</button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div id="output" class="col-md-12 text-dark text-left">

                                    </div>
                                </div>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <script>
        // Relleno la array con dos objetos predefinidos, dos "pequeños" alumnos.
        const studentsList = [(new Student("Belen", 87, 2)), (new Student("Javier", 5, 3))];

        // Recarga la estructura <option>
        reloadOptions();

        // Clase estudiante, Nombre, Edad, Especialidad, Compañero
        function Student(name, age, training, partner) {

            this.name = name;
            this.age = age;
            this.training = training;
            this.partner = partner;

            function getName() {
                return this.name;
            }
            this.getName = getName;

            function getAge() {
                return this.age;
            }
            this.getAge = getAge;

            function getTraining() {
                switch (this.training) {
                    case 1:
                        return "Sistemas";
                        break;
                    case 2:
                        return "Web";
                        break;
                    case 3:
                        return "MultPla..";
                        break;
                }
            }
            this.getTraining = getTraining;

            function getPartner() {
                return this.partner;
            }
            this.getPartner = getPartner;

            function setName(name) {
                this.name = name;
            }
            this.setName = setName;

            function setAge(age) {
                this.age = age;
            }
            this.setAge = setAge;

            function setTraining(training) {
                this.training = training;
            }
            this.setTraining = setTraining;

            function setTrainingName(trainingName) {
                switch (trainingName.toLowerCase()) {
                    case "sistemas":
                        this.training = 1;
                        break;
                    case "web":
                        this.training = 2;
                        break;
                    case "multiplataforma":
                        this.training = 3;
                        break;
                }
            }
            this.setTrainingName = setTrainingName;

            function setPartner(partner) {
                this.partner = Object.assign({}, partner);
            }
            this.setPartner = setPartner;

        }

        // Incluye los nuevos objetos dentro de la etiqueta <select>
        function reloadOptions() {
            let opt = '<option value="">Sin Profesor</option>';

            // Si no tiene compañero, no se incluye en el select
            studentsList.forEach(function(student) {
                if (student.getPartner() == undefined)
                    opt += '<option>' + student.getName() + '</option>';
            });

            document.getElementById("partner").innerHTML = opt;
        }

        document.querySelector('#save').onclick = (event) => {
            event.preventDefault();

            // Se crea una array con los datos escritos
            let arr = [document.getElementById("name").value, document.getElementById("age").value,
                document.getElementById("training").value, document.getElementById("partner").value];

            // Incluye el nuevo objeto en la array de alumnos
            studentsList.push(new Student(arr[0], arr[1], parseInt(arr[2]), arr[3]));

            // Reinicio de los campos del formulario
            document.getElementById("prototype").reset();
            reloadOptions();
        }

        document.querySelector('#search').onclick = (event) => {
            event.preventDefault();

            // Crea una tabla
            let code = '<table class="table"><thead>' +
                '<th scope="col">Nombre</th>' +
                '<th scope="col">Edad</th>' +
                '<th scope="col">Ciclo</th>' +
                '<th scope="col">Profesor</th></thead><tbody>';

            // Recorre el array estudiantes solicitando los datos
            studentsList.forEach(function(student) {
                code += '<tr><th scope="row">' +
                    student.getName() + '</th><td>' +
                    student.getAge() + '</td><td>' +
                    student.getTraining() + '</td><td>' +
                    student.getPartner() + '</td></tr>';
            });

            code += '</tbody></table>';

            // Inserta el codigo en el DOM
            for (let i = 0; i < studentsList.length; i++) {
                document.getElementById("output").innerHTML = code;
            }
        }

    </script>
</body>

</html>
